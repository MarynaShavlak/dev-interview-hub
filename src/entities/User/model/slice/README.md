# Documentation for 'userSlice'

## Overview
The `userSlice`  is a Redux slice that manages user authentication and related state. 
It leverages the `buildSlice` utility to handle user data, authentication status, and settings. This slice includes reducers for setting authentication data and logging out, as well as extra reducers for handling asynchronous actions related to user initialization and settings.

## Import Statements
```typescript
import { PayloadAction } from '@reduxjs/toolkit';
import { initAuthData } from '../services/initAuthData/initAuthData';
import { saveJsonSettings } from '../services/saveJsonSettings/saveJsonSettings';
import { JsonSettings } from '../types/jsonSettings';
import { setFeatureFlags } from '@/shared/lib/features';
import { buildSlice } from '@/shared/lib/store';
import {
    LOCAL_STORAGE_LAST_DESIGN_KEY,
    USER_LOCALSTORAGE_KEY,
} from '@/shared/const/localstorage';
import { UserSchema, User } from '../types/user';
```

- `PayloadAction`: A type from Redux Toolkit used to define the shape of action payloads.
- `buildSlice`: A custom utility function for creating Redux slices.
- `initAuthData`: Service function for initializing user authentication data.
- `saveJsonSettings`: Service function for saving user-specific JSON settings.
- `UserSchema` and  `User`: Service function for asynchronous login authentication.
- `JsonSettings`: TypeScript type defining the structure for user JSON settings.
- `setFeatureFlags`: Utility function for setting feature flags based on user data.
- `LOCAL_STORAGE_LAST_DESIGN_KEY` and `USER_LOCALSTORAGE_KEY`: Constants for local storage keys.


## Initial State
```typescript
const initialState: UserSchema = {
    _inited: false,
};
```

The initial state of the slice is defined using the `UserSchema` type.
It includes:
- `_inited`: Boolean indicating whether the user data has been initialized.


## Slice Definition
- **name**: The name of the slice, which is **'user'**.
- **initialState**: The initial state defined earlier.
- **reducers**: An object containing reducer functions.
- **extraReducers**: Handles asynchronous actions for `saveJsonSettings` and `initAuthData` service requests.

## Reducers

| **Reducer Name** | **Description**                                   | **Payload**  | **State Changes**                                             | **Purpose**                                          |
|------------------|---------------------------------------------------|--------------|--------------------------------------------------------------|------------------------------------------------------|
| `setAuthData`    | Sets the authentication data and updates local storage | `User`    | Updates `state.authData` with the payload value. Sets feature flags and updates local storage. | Updates user authentication state and manages local storage settings. |
| `logout`         | Clears authentication data and removes local storage entries | None   | Resets `state.authData` to `undefined` and removes local storage items. | Clears user authentication data and local storage on logout. |

## Extra Reducers

| **Action**                | **Description**                                      | **Payload**      | **State Changes**                                          | **Purpose**                                      |
|---------------------------|------------------------------------------------------|------------------|-----------------------------------------------------------|--------------------------------------------------|
| `saveJsonSettings.fulfilled` | Handles successful saving of JSON settings         | `JsonSettings`   | Updates `state.authData.jsonSettings` if `authData` is present. | Updates user settings with the new JSON settings. |
| `initAuthData.fulfilled`  | Handles successful initialization of user data       | `User`           | Updates `state.authData` with the payload and sets `_inited` to `true`. | Initializes user data and sets the initialization flag. |
| `initAuthData.rejected`   | Handles failed initialization of user data            | None             | Sets `_inited` to `true` regardless of the failure.       | Ensures the initialization flag is set even if initialization fails. |



## Exports
```typescript
export const {
    actions: userActions,
    reducer: userReducer,
    useActions: useUserActions,
} = userSlice;
```
- **loginActions**: An object containing the action creators generated by the slice.
- **loginReducer**: The reducer function to be used in the Redux store.
- **useLoginActions**: Custom hook to conveniently access actions in React components.


## Usage Example
```typescript jsx
import { useUserActions, userReducer } from '@/path/to/userSlice';
import { configureStore } from '@reduxjs/toolkit';

const store = configureStore({
    reducer: {
        login: loginReducer,
    },
});

// Dispatching an actions

import { useCallback } from 'react';
import { useAppDispatch } from '@/shared/lib/hooks/useAppDispatch/useAppDispatch';

export const UserProfile = () => {
    const dispatch = useAppDispatch();
    const { setAuthData, logout } = useUserActions();

    const handleLogin = useCallback((user) => {
        dispatch(setAuthData(user));
    }, [dispatch]);

    const handleLogout = useCallback(() => {
        dispatch(logout());
    }, [dispatch]);

    return (
        <div>
            <button onClick={() => handleLogin(user)}>Login</button>
            <button onClick={handleLogout}>Logout</button>
        </div>
    );
};
```

## Conclusion 
The `userSlice` efficiently manages user authentication and settings within the Redux store. It provides mechanisms for setting authentication data, handling logout, and integrating with asynchronous services for user data and settings. By utilizing this slice, you can ensure a well-organized and responsive user authentication flow within your application.
